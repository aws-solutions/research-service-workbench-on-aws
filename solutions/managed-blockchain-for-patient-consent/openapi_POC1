openapi: 3.0.0
info:
  version: '1.0.0'
  title: 'Magellan'
#   license:
#     name: MIT
# servers:
#   - url: 'localhost:3000'
paths:
  /signup:
    post:
      summary: 'Signup endpoint: registers a patient on Magellan'
      operationId: signup
      tags:
        - patient
      parameters:
        - name: idHash
          in: query
          description: Hashed ID of the user
          required: true
          schema:
            type: string
            format: uuid
        - name: consentRecordId
          in: query
          description: some uuid
          required: false
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User's consentRecordId
          content:
            text/plain:
              schema:
                type: string
        '200':
          description: OK

  /consent:
    post:
      summary: 'Consent endpoint: user consents for specific (scope) health records to be shared from source to destination organization'
      operationId: consent
      tags:
        - patient
      parameters:
        - name: idHash
          in: query
          description: Hased ID of the user
          required: true
          schema:
            type: string
            format: uuid
        - name: source
          in: query
          description: 'source organization'
          required: true
          schema:
            type: string
            format: uuid
        - name: dest
          in: query
          description: 'destination organization'
          required: true
          schema:
            type: string
            format: uuid
        - name: scope
          in: query
          description: 'type of behavior record'
          required: true
          schema:
            type: array
            items:
              type: string
      responses:
        '200':
          description: OK        
  /revoke:
    post:
      summary: 'Revoke endpoint: user revokes consent for source organization to send health records to destination organization'
      operationId: revoke
      tags:
        - patient
      parameters:
        - name: idHash
          in: query
          description: Hased ID of the user
          required: true
          schema:
            type: string
            format: uuid
        - name: source
          in: query
          description: 'source organization'
          required: true
          schema:
            type: string
            format: uuid
        - name: dest
          in: query
          description: 'destination organization'
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
          
  /set-org:
    post:
      summary: 'Set-org endpoint: Organization added to Magellan'
      operationId: set-org
      tags:
        - organization
      parameters:
        - name: name
          in: query
          description: 'organization name'
          required: true
          schema:
            type: string
            format: uuid
        - name: url
          in: query
          description: 'organization url'
          required: true
          schema:
            type: string
            format: uuid
        - name: memberId
          in: query
          description: organization's Magellan ID
          required: true
          schema:
            type: string
            format: uuid
        - name: publicKey
          in: query
          description: organization's public key
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK 

  /get-org:
    post:
      summary: 'get-org endpoint: Organization added to Magellan'
      operationId: get-org
      tags:
        - organization
      parameters:
        - name: orgId
          in: query
          description: organization's Magellan ID
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: organization's metadata
          content:
            text/plain:
              schema:
                type: string

  /get-consent:
    post:
      summary: 'Get-consent endpoint: Check if source organization has consent to send health records to destination organization'
      operationId: get-consent
      tags:
        - organization
      parameters:
        - name: idHash
          in: query
          description: hased ID of the user
          required: true
          schema:
            type: string
            format: uuid
        - name: source
          in: query
          description: source organization
          required: true
          schema:
            type: string
            format: uuid
        - name: dest
          in: query
          description: destination organization
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
        '400':
          description: Bad request. User ID must be an integer and larger than 0.
        '403':
          description: Not Authorized
        '404':
          description: A user with the specified ID was not found.


components:
  schemas:
    User:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        tag:
          type: string
    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: integer
          format: int32
        message:
          type: string
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
security:
  - BasicAuth: []