{"version":3,"file":"collectionResource.js","sourceRoot":"","sources":["collectionResource.ts"],"names":[],"mappings":";;;;;AAKA,oDAAuB;AAKvB,MAAqB,kBAAkB;IAUrC,YAAmB,aAA4B,EAAE,IAAY,EAAE,SAAiB,EAAE,YAAoB,EAAE;QACtG,IAAI,CAAC,MAAM,GAAG,aAAa,CAAC,QAAQ,EAAE,CAAC;QACvC,IAAI,CAAC,cAAc,GAAG,aAAa,CAAC;QACpC,IAAI,CAAC,cAAc,GAAG,aAAa,CAAC,gBAAgB,EAAE,CAAC;QACvD,IAAI,CAAC,SAAS,GAAG,aAAa,CAAC,WAAW,EAAE,CAAC;QAC7C,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;QAC5B,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;QAC5B,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;IACjB,CAAC;IAED,6DAA6D;IACtD,KAAK,CAAC,MAAM,CAAC,OAAY,EAAE,EAAE,eAAwB,IAAI;QAC9D,gHAAgH;QAChH,kGAAkG;QAClG,+GAA+G;QAC/G,4BAA4B;QAC5B,aAAa;QACb,IAAI,CAAC,gBAAC,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE;YACxC,MAAM,IAAI,KAAK,CACb,6BAA6B,IAAI,CAAC,KAAK,gCAAgC,IAAI,CAAC,UAAU,KAAK,CAC5F,CAAC;SACH;QAED,MAAM,WAAW,GAAG,YAAY,CAAC,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QACpE,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;QACxE,MAAM,EAAE,GAAG,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC;QAC5B,MAAM,MAAM,GAAG,GAAG,IAAI,CAAC,UAAU,IAAI,EAAE,EAAE,CAAC;QAC1C,aAAa;QACb,MAAM,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,CAAC;QAE/C,6DAA6D;QAC7D,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC,EAAE,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,IAAI,EAAE,CAAC,YAAY,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;QAE7F,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED,YAAY;IACL,KAAK,CAAC,GAAG,CAAC,WAAsC;QACrD,OAAO,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE,CAAC,CAAC;IACrE,CAAC;IAED,+EAA+E;IAC/E,2BAA2B;IACjB,cAAc,CAAC,WAAgB,EAAE;QACzC,OAAO,QAAQ,CAAC;IAClB,CAAC;CACF;AAzDD,qCAyDC","sourcesContent":["/*\n *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *  SPDX-License-Identifier: Apache-2.0\n */\nimport { AxiosInstance, AxiosResponse } from 'axios';\nimport _ from 'lodash';\nimport ClientSession from '../../clientSession';\nimport Setup from '../../setup';\nimport Settings from '../../utils/settings';\n\nexport default class CollectionResource {\n  private _type: string;\n  private _childType: string;\n  protected _axiosInstance: AxiosInstance;\n  protected _clientSession: ClientSession;\n  protected _settings: Settings;\n  protected _parentApi: string;\n  protected _api: string;\n  protected _setup: Setup;\n\n  public constructor(clientSession: ClientSession, type: string, childType: string, parentApi: string = '') {\n    this._setup = clientSession.getSetup();\n    this._clientSession = clientSession;\n    this._axiosInstance = clientSession.getAxiosInstance();\n    this._settings = clientSession.getSettings();\n    this._type = type;\n    this._childType = childType;\n    this._parentApi = parentApi;\n    this._api = '';\n  }\n\n  //eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public async create(body: any = {}, applyDefault: boolean = true): Promise<AxiosResponse> {\n    // Because of the cleanup logic, before we do the create, we need to ensure that the extender of this collection\n    // resource class has a method that returns the resource operations helper for the child resource.\n    // For example, if the extender class is 'Users' and it provides childType = 'user', then Users class must have\n    // a method called 'user()'.\n    // @ts-ignore\n    if (!_.isFunction(this[this._childType])) {\n      throw new Error(\n        `The collection resource ['${this._type}'] must have a method named [${this._childType}()]`\n      );\n    }\n\n    const requestBody = applyDefault ? this._buildDefaults(body) : body;\n    const response = await this._axiosInstance.post(this._api, requestBody);\n    const id = response.data.id;\n    const taskId = `${this._childType}-${id}`;\n    // @ts-ignore\n    const resourceNode = this[this._childType](id);\n\n    // We add a cleanup task to the cleanup queue for the session\n    this._clientSession.addCleanupTask({ id: taskId, task: async () => resourceNode.cleanup() });\n\n    return response;\n  }\n\n  // List call\n  public async get(queryParams: { [key: string]: string }): Promise<AxiosResponse> {\n    return this._axiosInstance.get(this._api, { params: queryParams });\n  }\n\n  // This method should be overridden by the class extending `CollectionResource`\n  // eslint-disable-next-line\n  protected _buildDefaults(resource: any = {}): any {\n    return resource;\n  }\n}\n"]}