version: 0.2
phases:
  install:
    runtime-versions:
      nodejs: 14
    commands:
      # For debugging purposes
      - ls -al
      - npm --version
      - node --version
      # Install dependencies
      - npm install -g aws-cdk

  build:
    commands:
      - cd solutions/swb-reference
      - STAGE='testEnv' node ../../common/scripts/install-run-rushx.js cdk-deploy
      - STAGE='testEnv' node ../../common/scripts/install-run-rushx.js run-postDeployment
      - cd ../swb-ui
      - STAGE='testEnv' node ../../common/scripts/install-run-rushx.js deploy-ui-and-api

artifacts:
  base-directory: cdk/cdk.out
  files:
    - "**/*"